<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThemeStash Post Generator (Updated)</title>
    <style>
        :root { --contentL: #ddd; --linkC: #007bff; --bg: #f9f9f9; --textC: #333; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: var(--bg); color: var(--textC); padding: 20px; line-height: 1.6; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        h1, h2 { text-align: center; color: var(--linkC); border-bottom: 1px solid var(--contentL); padding-bottom: 10px; margin-bottom: 25px; }
        label { margin-top: 15px; font-weight: 600; display: block; color: #555; }
        input[type="text"], input[type="number"], input[type="url"], textarea, select {
            padding: 12px; margin-top: 5px; border-radius: 5px; border: 1px solid var(--contentL);
            font-size: 16px; width: 100%; box-sizing: border-box; transition: border-color 0.2s, box-shadow 0.2s;
        }
        input:focus, textarea:focus, select:focus { border-color: var(--linkC); box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2); outline: none; }
        input[type="file"] { margin-top: 5px; padding: 8px; border: 1px solid #ccc; border-radius: 5px; }
        input[type="button"] {
            background-color: var(--linkC); color: white; width: 100%; padding: 14px; border: 0;
            border-radius: 5px; cursor: pointer; font-size: 18px; margin-top: 25px; font-weight: bold;
            transition: background-color 0.2s;
        }
        input[type="button"]:hover { background-color: #0056b3; }
        input[type="button"]:disabled { background-color: #ccc; cursor: not-allowed; }
        .msrequired::after { content: "*"; color: red; margin-left: 4px; }
        #outputContainer { margin-top: 30px; }
        pre { background-color: #f6f8fa; border: 1px solid #ddd; padding: 15px; border-radius: 6px; white-space: pre-wrap; word-wrap: break-word; max-height: 500px; overflow-y: auto; color: #333; font-family: 'Courier New', Courier, monospace; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem 1.5rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ThemeStash Post Generator</h1>
        
        <form id="postForm" class="ms-form">
            <h2>Post Details</h2>
            <div class="grid">
                <div><label for="postName" class="msrequired">Name</label><input type="text" id="postName" value="Apmody" required></div>
                <div><label for="platform">Platform</label><select id="platform"><option value="Blogger" selected>Blogger</option><option value="WordPress">WordPress</option></select></div>
                <div><label for="developer">Developer</label><input type="text" id="developer" value="Arman Kumar"></div>
                <div><label for="releaseDate">Release Date</label><input type="text" id="releaseDate"></div>
                <div><label for="lastUpdate">Last Update</label><input type="text" id="lastUpdate"></div>
                <div><label for="version">Version</label><input type="text" id="version" value="2.0"></div>
                <div><label for="views">Views</label><input type="number" id="views" value="200"></div>
                <div><label for="downloads">Downloads</label><input type="number" id="downloads" value="40"></div>
                <div><label for="format">Format</label><select id="format"><option value="XML" selected>XML</option><option value="ZIP">ZIP</option></select></div>
                <div><label for="size">Size</label><input type="text" id="size" value="121KB"></div>
                <div><label for="license">License</label><select id="license"><option value="Personal Use" selected>Personal Use</option><option value="Commercial Use">Commercial Use</option></select></div>
                <div><label for="responsive">Responsive</label><select id="responsive"><option value="Yes" selected>Yes</option><option value="No">No</option></select></div>
                <div><label for="darkMode">Dark Mode</label><select id="darkMode"><option value="Supported" selected>Supported</option><option value="Not Supported">Not Supported</option></select></div>
                <div><label for="browsers">Browsers</label><input type="text" id="browsers" value="Chrome, Firefox, Edge"></div>
                <div><label for="schemaMarkup">Schema Markup</label><select id="schemaMarkup"><option value="Yes" selected>Yes</option><option value="No">No</option></select></div>
                <div><label for="languages">Languages</label><input type="text" id="languages" value="English, Bangla"></div>
                <div><label for="colorOptions">Color Options</label><input type="text" id="colorOptions" value="Multiple"></div>
                <div><label for="documentation">Documentation</label><select id="documentation"><option value="Included" selected>Included</option><option value="Online">Online</option></select></div>
            </div>

            <h2>Files & Links</h2>
            <div class="grid">
                <div><label for="mainImage" class="msrequired">Main Image</label><input type="file" id="mainImage" class="msinput" accept="image/*" required></div>
                <div><label for="downloadFile" class="msrequired">Download File (.xml, .zip)</label><input type="file" id="downloadFile" class="msinput" required></div>
                <div><label for="previewUrl" class="msrequired">Preview URL</label><input type="url" id="previewUrl" placeholder="https://example.blogspot.com/" required></div>
            </div>

            <h2>Post Content</h2>
            <label for="postDescription">Description</label>
            <textarea id="postDescription" rows="5">Are you looking for a <strong>high-performance, visually stunning, and SEO-optimized</strong> Blogger template that can <strong>boost your traffic, engagement, and revenue</strong>? Look no further! <strong>Apmody 2.0</strong> is here to transform your blog into a <strong>professional, fast-loading, and mobile-friendly</strong> website that ranks higher on Google and keeps visitors coming back for more.</textarea>
            
            <input type="button" value="Generate Post HTML" onclick="generatePost()" id="generateBtn">
        </form>

        <div id="outputContainer">
            <h2>Generated HTML</h2>
            <pre id="generatedHtmlWrapper"><code id="generatedHtml">Generated HTML will appear here...</code></pre>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: '2-digit' });
            document.getElementById('releaseDate').value = today;
            document.getElementById('lastUpdate').value = today;
        });

        async function uploadToGitHub(file, path) {
            const reader = new FileReader();
            const fileContent = await new Promise((resolve, reject) => {
                reader.onload = event => resolve(event.target.result.split(',')[1]);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
            
            const response = await fetch(`/.netlify/functions/upload`, {
                method: 'POST',
                body: JSON.stringify({ filePath: `${path}/${file.name}`, fileContent })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'File upload failed.');
            }
            const data = await response.json();
            return data.download_url;
        }

        async function generatePost() {
            const mainImageFile = document.getElementById('mainImage').files[0];
            const downloadFile = document.getElementById('downloadFile').files[0];
            if (!mainImageFile || !downloadFile) {
                alert("Please select both an image and a theme file.");
                return;
            }
            
            const generateButton = document.getElementById('generateBtn');
            
            try {
                generateButton.value = "Uploading Files... Please Wait...";
                generateButton.disabled = true;

                const imageUrl = await uploadToGitHub(mainImageFile, 'Assets/Image');
                const downloadUrl = await uploadToGitHub(downloadFile, 'Assets/Theme');
                
                generateButton.value = "Generating HTML...";

                const postData = {};
                const fields = [
                    "postName", "platform", "developer", "releaseDate", "lastUpdate", 
                    "version", "views", "downloads", "format", "size", "license", 
                    "responsive", "darkMode", "browsers", "schemaMarkup", "languages", 
                    "colorOptions", "documentation", "postDescription", "previewUrl"
                ];
                fields.forEach(id => {
                    postData[id] = document.getElementById(id).value;
                });
                
                const finalPreviewLink = `https://cdnix.pages.dev/preview/?u=${btoa(postData.previewUrl)}`;

                // This HTML template is now updated based on your new structure.
                const htmlOutput = `<img alt='${postData.postName} Template' src='${imageUrl}'/>

<div class="pST">
    <div><div><i class="hgi-stroke hgi-file-01"></i></div><div><span>Name</span><span>${postData.postName}</span></div></div>
    <div><div><i class="hgi-stroke hgi-database"></i></div><div><span>Platform</span><span>${postData.platform}</span></div></div>
    <div><div><i class="hgi-stroke hgi-user-02"></i></div><div><span>Developer</span><span>${postData.developer}</span></div></div>
    <div><div><i class="hgi-stroke hgi-calendar-03"></i></div><div><span>Release</span><span>${postData.releaseDate}</span></div></div>
    <div><div><i class="hgi-stroke hgi-workflow-circle-06"></i></div><div><span>Last Update</span><span>${postData.lastUpdate}</span></div></div>
    <div><div><i class="hgi-stroke hgi-saturn-01"></i></div><div><span>Version</span><span>${postData.version}</span></div></div>
    <div><div><i class="hgi-stroke hgi-view"></i></div><div><span>Views</span><span>${postData.views}</span></div></div>
    <div><div><i class="hgi-stroke hgi-cloud-download"></i></div><div><span>Downloads</span><span>${postData.downloads}</span></div></div>
    <div><div><i class="hgi-stroke hgi-xml-01"></i></div><div><span>Format</span><span>${postData.format}</span></div></div>
    <div><div><i class="hgi-stroke hgi-usb-memory-01"></i></div><div><span>Size</span><span>${postData.size}</span></div></div>
    <div><div><i class="hgi-stroke hgi-crown"></i></div><div><span>License</span><span>${postData.license}</span></div></div>
    <div><div><i class="hgi-stroke hgi-laptop-phone-sync"></i></div><div><span>Responsive</span><span>${postData.responsive}</span></div></div>
    <div><div><i class="hgi-stroke hgi-moon-02"></i></div><div><span>Dark Mode</span><span>${postData.darkMode}</span></div></div>
    <div><div><i class="hgi-stroke hgi-chrome"></i></div><div><span>Browsers</span><span>${postData.browsers}</span></div></div>
    <div><div><i class="hgi-stroke hgi-browser"></i></div><div><span>Schema Markup</span><span>${postData.schemaMarkup}</span></div></div>
    <div><div><i class="hgi-stroke hgi-translation"></i></div><div><span>Languages</span><span>${postData.languages}</span></div></div>
    <div><div><i class="hgi-stroke hgi-paint-brush-04"></i></div><div><span>Color Options</span><span>${postData.colorOptions}</span></div></div>
    <div><div><i class="hgi-stroke hgi-book-open-02"></i></div><div><span>Documentation</span><span>${postData.documentation}</span></div></div>
</div>
<p>${postData.postDescription}</p>

<div class="button-grid">
    <a class="button safeL" href="${downloadUrl}"><i class="icon dl"></i>Download</a>
    <a class="button" href="${finalPreviewLink}" target="_blank"><i class="icon eye"></i>Preview</a>
</div>
<p><strong>Stay Updated!</strong><br>
Follow <strong><a href="https://themes.merazalvee.com" target="_blank">ThemeStash</a></strong> for more <strong>free Blogger templates, SEO tips, and blogging guides</strong>.</p>`;

                document.getElementById('generatedHtml').textContent = htmlOutput.trim();
                alert("Post HTML Generated Successfully!");

            } catch (error) {
                alert(`An error occurred: ${error.message}`);
                console.error(error);
            } finally {
                generateButton.value = "Generate Post HTML";
                generateButton.disabled = false;
            }
        }
    </script>
</body>
</html>
