<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ThemeStash Post Generator [Full-Width]</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for dark mode and file input */
        :root {
            --bg: #f8fafc; /* slate-50 */
            --fg: #0f172a; /* slate-900 */
            --card-bg: #ffffff;
            --border: #e2e8f0; /* slate-200 */
            --muted-fg: #64748b; /* slate-500 */
        }
        html.dark {
            --bg: #0f172a; /* slate-900 */
            --fg: #f8fafc; /* slate-50 */
            --card-bg: #1e293b; /* slate-800 */
            --border: #334155; /* slate-700 */
            --muted-fg: #94a3b8; /* slate-400 */
        }
        body {
            background-color: var(--bg);
            color: var(--fg);
        }
        input[type="file"]::file-selector-button {
            @apply bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 font-semibold border-0 px-4 py-2 rounded-lg cursor-pointer hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors;
        }
    </style>
</head>
<body class="font-sans p-4 sm:p-6 md:p-8">

    <header class="text-center mb-10">
        <h1 class="text-3xl md:text-4xl font-bold text-sky-500">ThemeStash Post Generator</h1>
        <p class="text-slate-400 mt-2">Create your blog posts with ease and style.</p>
    </header>

    <form id="postForm" class="space-y-8 max-w-6xl mx-auto"> <div class="bg-[var(--card-bg)] p-6 md:p-8 rounded-2xl shadow-lg">
            <h2 class="text-2xl font-semibold text-[var(--fg)] border-b border-[var(--border)] pb-4 mb-6">Post Details</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div><label for="postName" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Name</label><input type="text" id="postName" value="Apmody" required class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"></div>
                <div><label for="platform" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Platform</label><select id="platform" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"><option value="Blogger" selected>Blogger</option><option value="WordPress">WordPress</option></select></div>
                <div><label for="developer" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Developer</label><input type="text" id="developer" value="Arman Kumar" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"></div>
                <div><label for="releaseDate" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Release Date</label><input type="text" id="releaseDate" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"></div>
                <div><label for="lastUpdate" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Last Update</label><input type="text" id="lastUpdate" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"></div>
                <div><label for="version" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Version</label><input type="text" id="version" value="2.0" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"></div>
                <div><label for="views" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Views</label><input type="number" id="views" value="200" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"></div>
                <div><label for="downloads" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Downloads</label><input type="number" id="downloads" value="40" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"></div>
                <div><label for="format" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Format</label><select id="format" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"><option value="XML" selected>XML</option><option value="ZIP">ZIP</option></select></div>
                <div><label for="size" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Size</label><input type="text" id="size" value="121KB" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"></div>
                <div><label for="license" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">License</label><select id="license" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"><option value="Personal Use" selected>Personal Use</option><option value="Commercial Use">Commercial Use</option></select></div>
                <div><label for="responsive" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Responsive</label><select id="responsive" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"><option value="Yes" selected>Yes</option><option value="No">No</option></select></div>
                <div><label for="darkMode" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Dark Mode</label><select id="darkMode" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"><option value="Supported" selected>Supported</option><option value="Not Supported">Not Supported</option></select></div>
                <div><label for="browsers" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Browsers</label><input type="text" id="browsers" value="Chrome, Firefox, Edge" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"></div>
                <div><label for="schemaMarkup" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Schema Markup</label><select id="schemaMarkup" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"><option value="Yes" selected>Yes</option><option value="No">No</option></select></div>
                <div><label for="languages" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Languages</label><input type="text" id="languages" value="English, Bangla" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"></div>
                <div><label for="colorOptions" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Color Options</label><input type="text" id="colorOptions" value="Multiple" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"></div>
                <div><label for="documentation" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Documentation</label><select id="documentation" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"><option value="Included" selected>Included</option><option value="Online">Online</option></select></div>
            </div>
        </div>

        <div class="bg-[var(--card-bg)] p-6 md:p-8 rounded-2xl shadow-lg">
            <h2 class="text-2xl font-semibold text-[var(--fg)] border-b border-[var(--border)] pb-4 mb-6">Files & Links</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 items-start">
                <div><label for="mainImage" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Main Image</label><input type="file" id="mainImage" accept="image/*" required class="w-full text-sm text-slate-500 border border-[var(--border)] rounded-lg cursor-pointer"></div>
                <div><label for="downloadFile" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Download File</label><input type="file" id="downloadFile" required class="w-full text-sm text-slate-500 border border-[var(--border)] rounded-lg cursor-pointer"></div>
                <div><label for="previewUrl" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Preview URL</label><input type="url" id="previewUrl" placeholder="https://example.blogspot.com/" required class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition"></div>
            </div>
        </div>

        <div class="bg-[var(--card-bg)] p-6 md:p-8 rounded-2xl shadow-lg">
            <h2 class="text-2xl font-semibold text-[var(--fg)] border-b border-[var(--border)] pb-4 mb-6">Gallery Images <span class="text-sm font-normal text-slate-400">(Optional)</span></h2>
            <input type="file" id="galleryImages" multiple accept="image/*" class="w-full text-sm text-slate-500 border border-[var(--border)] rounded-lg cursor-pointer">
            <div id="galleryPreview" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-4 mt-4"></div>
        </div>

        <div class="bg-[var(--card-bg)] p-6 md:p-8 rounded-2xl shadow-lg">
            <h2 class="text-2xl font-semibold text-[var(--fg)] border-b border-[var(--border)] pb-4 mb-6">Post Content</h2>
            <label for="postDescription" class="block text-sm font-medium text-[var(--muted-fg)] mb-1">Description</label>
            <textarea id="postDescription" rows="5" class="w-full px-4 py-2 bg-[var(--bg)] border border-[var(--border)] rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition">Are you looking for a <strong>high-performance, visually stunning, and SEO-optimized</strong> Blogger template that can <strong>boost your traffic, engagement, and revenue</strong>? Look no further! <strong>Apmody 2.0</strong> is here to transform your blog into a <strong>professional, fast-loading, and mobile-friendly</strong> website that ranks higher on Google and keeps visitors coming back for more.</textarea>
        </div>
        
        <button type="button" onclick="generatePost()" id="generateBtn" class="w-full bg-sky-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-sky-700 transition-all duration-300 disabled:bg-slate-400 disabled:cursor-not-allowed flex items-center justify-center space-x-3 shadow-lg shadow-sky-500/20 hover:shadow-xl hover:shadow-sky-500/30">
            <svg id="spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
            <span id="btn-text">Generate Post HTML</span>
        </button>
    </form>

    <div class="bg-[var(--card-bg)] p-6 md:p-8 rounded-2xl shadow-lg mt-10 max-w-6xl mx-auto">
        <div class="flex justify-between items-center border-b border-[var(--border)] pb-4 mb-6">
            <h2 class="text-2xl font-semibold text-[var(--fg)]">Generated HTML</h2>
            <button id="copyBtn" class="bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 font-semibold text-sm px-4 py-2 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors flex items-center space-x-2">
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                <span>Copy</span>
            </button>
        </div>
        <pre class="bg-[var(--bg)] p-4 rounded-lg overflow-x-auto"><code id="generatedHtml" class="text-sm">Generated HTML will appear here...</code></pre>
    </div>

    <script>
        document.getElementById('copyBtn').addEventListener('click', () => {
            const codeToCopy = document.getElementById('generatedHtml').textContent;
            if (navigator.clipboard && codeToCopy) {
                navigator.clipboard.writeText(codeToCopy).then(() => {
                    const copyBtnSpan = document.querySelector('#copyBtn span');
                    copyBtnSpan.textContent = 'Copied!';
                    setTimeout(() => {
                        copyBtnSpan.textContent = 'Copy';
                    }, 2000);
                }).catch(err => {
                    alert('Failed to copy!');
                    console.error('Could not copy text: ', err);
                });
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: '2-digit' });
            document.getElementById('releaseDate').value = today;
            document.getElementById('lastUpdate').value = today;
            
            const galleryInput = document.getElementById('galleryImages');
            const previewContainer = document.getElementById('galleryPreview');

            galleryInput.addEventListener('change', () => {
                previewContainer.innerHTML = '';
                if(galleryInput.files.length > 0) {
                    for (const file of galleryInput.files) {
                        const reader = new FileReader();
                        reader.onload = e => {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = "w-full h-24 object-cover rounded-lg shadow-md";
                            previewContainer.appendChild(img);
                        };
                        reader.readAsDataURL(file);
                    }
                }
            });
        });

        async function uploadToGitHub(file, path) {
            const reader = new FileReader();
            const fileContent = await new Promise((resolve, reject) => {
                reader.onload = event => resolve(event.target.result.split(',')[1]);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
            
            const domainPrefix = 'themestash-';
            const newFileName = domainPrefix + file.name.replace(/\s+/g, '-'); 
            
            const response = await fetch(`/.netlify/functions/upload`, {
                method: 'POST',
                body: JSON.stringify({ filePath: `${path}/${newFileName}`, fileContent })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'File upload failed.');
            }
            
            const siteDomain = "https://themestash.netlify.app";
            return `${siteDomain}/${path}/${newFileName}`;
        }

        async function generatePost() {
            if (!document.getElementById('mainImage').files.length || !document.getElementById('downloadFile').files.length) {
                alert("Please select a Main Image and a Download File.");
                return;
            }

            const generateButton = document.getElementById('generateBtn');
            const buttonText = document.getElementById('btn-text');
            const spinner = document.getElementById('spinner');
            
            try {
                spinner.classList.remove('hidden');
                buttonText.textContent = 'Uploading...';
                generateButton.disabled = true;

                // Collect all form data at the beginning
                const postData = {};
                const fields = ["postName", "platform", "developer", "releaseDate", "lastUpdate", "version", "views", "downloads", "format", "size", "license", "responsive", "darkMode", "browsers", "schemaMarkup", "languages", "colorOptions", "documentation", "postDescription", "previewUrl"];
                fields.forEach(id => { postData[id] = document.getElementById(id).value; });

                const mainImagePromise = uploadToGitHub(document.getElementById('mainImage').files[0], 'Assets/Image');
                const downloadPromise = uploadToGitHub(document.getElementById('downloadFile').files[0], 'Assets/Theme');
                
                const [imageUrl, downloadUrl] = await Promise.all([mainImagePromise, downloadPromise]);

                const galleryFiles = document.getElementById('galleryImages').files;
                let galleryHtml = '';
                if (galleryFiles.length > 0) {
                    let uploadedCount = 0;
                    let galleryImageUrls = [];
                    for (const file of galleryFiles) {
                        buttonText.textContent = `Uploading Gallery (${++uploadedCount}/${galleryFiles.length})...`;
                        const url = await uploadToGitHub(file, 'Assets/Image/Gallery');
                        galleryImageUrls.push(url);
                    }
                    
                    if (galleryImageUrls.length > 0) {
                         // UPDATED: Use postData.postName for the alt text
                         const galleryImagesHtml = galleryImageUrls.map(url => `  <img alt='${postData.postName}' src='${url}'/>`).join('\n');
                         galleryHtml = `\n\n<div class='glImg'>\n${galleryImagesHtml}\n</div>`;
                    }
                }

                buttonText.textContent = 'Generating HTML...';
                
                const finalPreviewLink = `https://cdnix.pages.dev/preview/?u=${btoa(postData.previewUrl)}`;

                const mainHtml = `<img alt='${postData.postName} Template' src='${imageUrl}'/>
<div class="pST">
    <div><div><i class="hgi-stroke hgi-file-01"></i></div><div><span>Name</span><span>${postData.postName}</span></div></div>
    <div><div><i class="hgi-stroke hgi-database"></i></div><div><span>Platform</span><span>${postData.platform}</span></div></div>
    <div><div><i class="hgi-stroke hgi-user-02"></i></div><div><span>Developer</span><span>${postData.developer}</span></div></div>
    <div><div><i class="hgi-stroke hgi-calendar-03"></i></div><div><span>Release</span><span>${postData.releaseDate}</span></div></div>
    <div><div><i class="hgi-stroke hgi-workflow-circle-06"></i></div><div><span>Last Update</span><span>${postData.lastUpdate}</span></div></div>
    <div><div><i class="hgi-stroke hgi-saturn-01"></i></div><div><span>Version</span><span>${postData.version}</span></div></div>
    <div><div><i class="hgi-stroke hgi-view"></i></div><div><span>Views</span><span>${postData.views}</span></div></div>
    <div><div><i class="hgi-stroke hgi-cloud-download"></i></div><div><span>Downloads</span><span>${postData.downloads}</span></div></div>
    <div><div><i class="hgi-stroke hgi-xml-01"></i></div><div><span>Format</span><span>${postData.format}</span></div></div>
    <div><div><i class="hgi-stroke hgi-usb-memory-01"></i></div><div><span>Size</span><span>${postData.size}</span></div></div>
    <div><div><i class="hgi-stroke hgi-crown"></i></div><div><span>License</span><span>${postData.license}</span></div></div>
    <div><div><i class="hgi-stroke hgi-laptop-phone-sync"></i></div><div><span>Responsive</span><span>${postData.responsive}</span></div></div>
    <div><div><i class="hgi-stroke hgi-moon-02"></i></div><div><span>Dark Mode</span><span>${postData.darkMode}</span></div></div>
    <div><div><i class="hgi-stroke hgi-chrome"></i></div><div><span>Browsers</span><span>${postData.browsers}</span></div></div>
    <div><div><i class="hgi-stroke hgi-browser"></i></div><div><span>Schema Markup</span><span>${postData.schemaMarkup}</span></div></div>
    <div><div><i class="hgi-stroke hgi-translation"></i></div><div><span>Languages</span><span>${postData.languages}</span></div></div>
    <div><div><i class="hgi-stroke hgi-paint-brush-04"></i></div><div><span>Color Options</span><span>${postData.colorOptions}</span></div></div>
    <div><div><i class="hgi-stroke hgi-book-open-02"></i></div><div><span>Documentation</span><span>${postData.documentation}</span></div></div>
</div>
<p>${postData.postDescription}</p>
<div class="button-grid">
    <a class="button safeL" href="${downloadUrl}"><i class="icon dl"></i>Download</a>
    <a class="button" href="${finalPreviewLink}" target="_blank"><i class="icon eye"></i>Preview</a>
</div>`;

                const footerHtml = `\n<p><strong>Stay Updated!</strong><br>
Follow <strong><a href="https://themes.merazalvee.com" target="_blank">ThemeStash</a></strong> for more <strong>free Blogger templates, SEO tips, and blogging guides</strong>.</p>`;
                
                const finalHtmlOutput = mainHtml + galleryHtml + footerHtml;

                document.getElementById('generatedHtml').textContent = finalHtmlOutput.trim();
                alert("Post HTML Generated Successfully!");

            } catch (error) {
                alert(`An error occurred: ${error.message}`);
                console.error(error);
            } finally {
                spinner.classList.add('hidden');
                buttonText.textContent = 'Generate Post HTML';
                generateButton.disabled = false;
            }
        }
    </script>
</body>
</html>
